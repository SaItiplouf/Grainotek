<div class="h-screen bg-gray-100 p-4 flex">
  <!-- Liste des messages -->
  <div class="w-1/4 bg-white rounded-lg scrollbar scrollbar-thumb-gray-900 scrollbar-track-gray-100 overflow-y-scroll">
    <div class="p-4 border-b border-gray-200">
      <input class="w-full p-2 rounded border border-gray-300" placeholder="Recherche..." type="text">
    </div>
    <div (click)="selectRoom(room)" *ngFor="let room of rooms"
         [ngClass]="{'bg-gray-200 cursor-not-allowed': selectedRoom?.id === room.id, 'unread-room': room.unreadCount && room.unreadCount > 0 }"
         class="p-4 cursor-pointer hover:bg-gray-100">
      <span *ngIf="room.unreadCount && room.unreadCount > 0" class="unread-count">{{ room.unreadCount }}</span>
      <div class="flex items-center">
        <div *ngIf="isLoading[room.id]" class="h-10 w-10">
          <div class="loader"></div>
        </div>
        <img (error)="handleImageError(room)"
             (load)="handleImageLoad(room)"
             [hidden]="isLoading[room.id]"
             [src]="getRecipient(room)?.pictureUrl || 'https://via.placeholder.com/50'"
             alt="User Image"
             class="h-10 w-10 rounded-full">

        <div class="ml-4">
          <h4 class="text-lg">{{ room.name }}</h4>
          <p class="text-sm text-gray-500">{{ getLastMessage(room)?.message }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Zone de chat -->
  <div class="w-3/4 bg-white rounded-lg flex flex-col shadow-lg">
    <!-- Messages -->
    <div #messageList class="flex-1 p-4 overflow-y-scroll">
      <div *ngFor="let message of selectedRoom?.messages">
        <div [ngClass]="message.user.id === currentUser!.id ? 'justify-end' : 'justify-start'"
             class="flex items-end mb-4">
          <!-- Si le message est du destinataire, affichez l'image à gauche -->
          <div *ngIf="message.user.id !== currentUser!.id" class="flex-none">
            <img [src]="message.user.pictureUrl || 'https://via.placeholder.com/40'" alt="User Image"
                 class="h-8 w-8 rounded-full shadow-sm">
          </div>

          <div [ngClass]="message.user.id === currentUser!.id ? 'bg-gray-400 text-white' : 'bg-blue-600 text-white'"
               class="ml-4 p-3 rounded-lg max-w-md shadow-md hover:bg-opacity-90 transition-all duration-300">
            {{ message.message }}
          </div>

          <!-- Si le message est de l'utilisateur actuel, affichez l'image à droite -->
          <div *ngIf="message.user.id === currentUser!.id" class="flex-none">
            <img [src]="message.user.pictureUrl || 'https://via.placeholder.com/40'" alt="User Image"
                 class="h-8 w-8 rounded-full shadow-sm">
          </div>
        </div>
      </div>
    </div>


    <!-- Zone de saisie -->
    <div class="p-4 border-t border-gray-200">
      <div class="flex items-center">
        <input (keyup.enter)="sendMessage()"
               [(ngModel)]="newMessageContent"
               class="flex-grow p-3 rounded-l border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Écrivez un message..."
               type="text">
        <button (click)="sendMessage()"
                class="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600 transition-colors">
          Envoyer
        </button>

      </div>
    </div>
  </div>
</div>
